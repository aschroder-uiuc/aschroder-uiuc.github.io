<!doctype html>
<html lang="en">
  <head>
    <title>Book Recommendations for Wikipedia Topics</title>
  </head>
  <style>
    body {
      margin-left: 20px;
    }
  </style>  
  <body>
    <script src="lunr.js"></script>
    <script src="wikipedia.js"></script>
    <script src="recommendations.js"></script>
    <script src="utils.js"></script>

    <h1>Book Recommendations for Wikipedia Topics</h1>
    <p>Enter topic here:</p>
    <input type="text" id="searchInput" placeholder="Jupiter" />
    <button id="searchButton">Search</button>

    <h2>Optional user preferences:</h2>
    <div style="display: flex; gap: 10px; align-items: center;">
    <p>Genre:</p>
    <select id="genreDropdown">
      <option value="">--Genre--</option>
    </select>

    <p>Location:</p>
    <select id="locationDropdown">
      <option value="">--Location--</option>
    </select>

    <p>Subject:</p>
    <select id="subjectDropdown">
      <option value="">--Subject--</option>
    </select>
    </div>

    <div id="recommendations">This is the book recommendations div.</div>
    <p>------------------------------------------------------------</p>
    <div id="wikipedia">This is the wikipedia div.</div>

    <script>
      document.addEventListener("DOMContentLoaded", populateGenreDropdown);
      function populateGenreDropdown() {
        const genreList = getGenreList();
        const dropdown = document.getElementById("genreDropdown");
        genreList.forEach((genre) => {
          const option = document.createElement("option");
          option.value = genre;
          option.textContent = genre;
          dropdown.appendChild(option);
        });
      }
      document.addEventListener("DOMContentLoaded", populateLocationDropdown);
      function populateLocationDropdown() {
        const settingsList = getSettingsList();
        console.log('in event listener', settingsList)
        const dropdown = document.getElementById("locationDropdown");
        settingsList.forEach((setting) => {
          const option = document.createElement("option");
          option.value = setting;
          option.textContent = setting;
          dropdown.appendChild(option);
        });
      }
      document.addEventListener("DOMContentLoaded", populateSubjectDropdown);
      function populateSubjectDropdown() {
        const subjectList = getSubjectList();
        const dropdown = document.getElementById("subjectDropdown");
        subjectList.forEach((subject) => {
          const option = document.createElement("option");
          option.value = subject;
          option.textContent = subject;
          dropdown.appendChild(option);
        });
      }
    </script>
    <script>
      document
        .getElementById("searchButton")
        .addEventListener("click", async () => {
          const subject = document.getElementById("searchInput").value.trim();
          if (!subject) {
            alert("Please enter a search term to get a recommendation.");
            return;
          }

          const wikipediaText = await getWikipediaText(subject);
          document.getElementById("wikipedia").innerText = wikipediaText;
          const recommendation = getBookRecommendation(wikipediaText, subject);
          document.getElementById("recommendations").innerHTML = recommendation;
        });
    </script>
    <script>
      function getBookRecommendation(wikipediaText, subject) {
        const bookList = getBookList();
        const recommendation = recommendBooks(wikipediaText, bookList);
        const recommendationText = getRecommendationText(
          recommendation,
          subject,
        );
        return recommendationText;
      }
    </script>
  </body>
</html>
